{
  "summary": {
    "total_tests": 5,
    "passed": 0,
    "failed": 5,
    "success_rate": 0.0,
    "total_duration": 198.125483,
    "start_time": "2025-09-06T00:13:07.760462",
    "end_time": "2025-09-06T00:16:25.885945",
    "deployment_ready": false
  },
  "results": [
    {
      "script": "pytest",
      "description": "Unit Tests",
      "success": false,
      "return_code": 4,
      "stdout": "",
      "stderr": "/home/husni/project-permit-api/venv/lib/python3.12/site-packages/_pytest/config/__init__.py:328: PluggyTeardownRaisedWarning: A plugin raised an exception during an old-style hookwrapper teardown.\nPlugin: helpconfig, Hook: pytest_cmdline_parse\nUsageError: usage: __main__.py [options] [file_or_dir] [file_or_dir] [...]\n__main__.py: error: unrecognized arguments: --json-report --json-report-file=test-results.json\n  inifile: /home/husni/project-permit-api/pytest.ini\n  rootdir: /home/husni/project-permit-api\nFor more information see https://pluggy.readthedocs.io/en/stable/api_reference.html#pluggy.PluggyTeardownRaisedWarning\n  config = pluginmanager.hook.pytest_cmdline_parse(\nERROR: usage: __main__.py [options] [file_or_dir] [file_or_dir] [...]\n__main__.py: error: unrecognized arguments: --json-report --json-report-file=test-results.json\n  inifile: /home/husni/project-permit-api/pytest.ini\n  rootdir: /home/husni/project-permit-api\n\n",
      "duration": -4.76837158203125e-07,
      "test_summary": {
        "total": 0,
        "passed": 0,
        "failed": 0,
        "errors": 0
      }
    },
    {
      "script": "scripts/validate_auth_deployment.py",
      "description": "Deployment Validation",
      "success": false,
      "return_code": 1,
      "stdout": "[2025-09-06 00:13:09] INFO: \ud83d\ude80 Starting Authentication Deployment Validation\n[2025-09-06 00:13:09] INFO: ============================================================\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running API Reachability...\n[2025-09-06 00:13:09] INFO: \u274c API Reachability: API unreachable: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /health (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c82d36f00>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Auth Endpoints...\n[2025-09-06 00:13:09] INFO: \u274c Auth Endpoint /auth/register: Endpoint error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821ec290>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \u274c Auth Endpoint /auth/login: Endpoint error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/login (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821bf1a0>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \u274c Auth Endpoint /auth/refresh: Endpoint error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/refresh (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821ec2f0>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \u274c Auth Endpoint /auth/logout: Endpoint error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/logout (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821ecb60>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running User Registration...\n[2025-09-06 00:13:09] INFO: \u274c User Registration: Registration error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/register (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821ed220>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running User Login...\n[2025-09-06 00:13:09] INFO: \u274c User Login: No test user available\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Protected Endpoints...\n[2025-09-06 00:13:09] INFO: \u274c Protected Endpoints: No authentication token available\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Rate Limiting...\n[2025-09-06 00:13:09] INFO: \u274c Rate Limiting: Rate limiting test error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/login (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821edac0>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Security Headers...\n[2025-09-06 00:13:09] INFO: \u274c Security Headers: Security headers test error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /health (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821bf920>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Database Connectivity...\n[2025-09-06 00:13:09] INFO: \u274c Database Connectivity: Database test error: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /api/permits/search (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821ee0f0>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Email Service...\n[2025-09-06 00:13:09] INFO: \u274c Email Service: No authentication token available\n[2025-09-06 00:13:09] INFO: \n\ud83d\udccb Running Error Handling...\n[2025-09-06 00:13:09] INFO: \u274c Error Handling: Error handling test failed: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /auth/login (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x755c821ecef0>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:13:09] INFO: \n============================================================\n[2025-09-06 00:13:09] INFO: \ud83d\udcca DEPLOYMENT VALIDATION SUMMARY:\n[2025-09-06 00:13:09] INFO:    Tests Passed: 0/10\n[2025-09-06 00:13:09] INFO:    Success Rate: 0.0%\n[2025-09-06 00:13:09] INFO:    Duration: 0.02s\n[2025-09-06 00:13:09] INFO:    Status: \u26a0\ufe0f  ISSUES FOUND\n[2025-09-06 00:13:09] INFO: \ud83d\udcc4 Detailed report saved: /home/husni/project-permit-api/deployment_validation_20250906_001309.json\n",
      "stderr": "",
      "duration": 0.3327925205230713
    },
    {
      "script": "scripts/ci_cd_auth_tests.py",
      "description": "CI/CD Tests",
      "success": false,
      "return_code": 1,
      "stdout": "[2025-09-06 00:13:12] INFO: \ud83d\ude80 Starting CI/CD Authentication Tests\n[2025-09-06 00:13:12] INFO: ==================================================\n[2025-09-06 00:13:12] INFO: \n\ud83d\udccb Running Dependencies...\n[2025-09-06 00:13:12] INFO: Testing Python dependencies...\n[2025-09-06 00:13:12] INFO: Running: Dependencies test\n[2025-09-06 00:13:13] INFO: \u274c Dependencies test failed\n[2025-09-06 00:13:13] INFO: Traceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nModuleNotFoundError: No module named 'jwt'\n\n[2025-09-06 00:13:13] INFO: \n\ud83d\udccb Running Database...\n[2025-09-06 00:13:13] INFO: Testing database migrations...\n[2025-09-06 00:13:13] INFO: Running: Database connection test\n[2025-09-06 00:13:13] INFO: \u2705 Database tests passed\n[2025-09-06 00:13:13] INFO: \n\ud83d\udccb Running Unit Tests...\n[2025-09-06 00:13:13] INFO: Running unit tests...\n[2025-09-06 00:13:13] INFO: Running: Unit tests\n[2025-09-06 00:15:32] INFO: \u274c Unit tests failed\n[2025-09-06 00:15:32] INFO: ============================= test session starts ==============================\nplatform linux -- Python 3.12.3, pytest-7.4.0, pluggy-1.6.0\nrootdir: /home/husni/project-permit-api\nconfigfile: pytest.ini\nplugins: anyio-4.10.0\ncollected 76 items\n\ntests/quick_test.py s.                                                   [  2%]\ntests/test_api.py ..............                                         [ 21%]\ntests/test_auth.py FFFF.FFFFFFF                                          [ 36%]\ntests/test_cevs.py .........                                             [ 48%]\ntests/test_global_routes.py sssssssssssssss                              [ 68%]\ntests/test_permits.py ..                                                 [ 71%]\ntests/test_search_params.py ....                                         [ 76%]\ntests/test_search_permits.py ....                                        [ 81%]\ntests/test_search_single_param.py .                                      [ 82%]\ntests/test_security.py FFF.FF.FF.F.F                                     [100%]\n\n=================================== FAILURES ===================================\n____________________________ test_user_registration ____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:22: in test_user_registration\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('test_4bd73d0a-9131-41de-a96e-b566dda26e4b@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:17,986 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_______________________________ test_user_login ________________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:40: in test_user_login\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('login_test_aca7dd64-f39c-4d2e-9280-eb3d7e93ee75@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:19,737 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n______________________________ test_invalid_login ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:64: in test_invalid_login\n    response = client.post(\"/auth/login\", json=login_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:117: in login\n    user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('nonexistent@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:21,108 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_password_validation ___________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:76: in test_password_validation\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('weak_pass_fdbb720b-db88-49c6-b05b-c7e5fe62da75@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:22,487 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n______________________ test_duplicate_email_registration _______________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:102: in test_duplicate_email_registration\n    response1 = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('duplicate_b7526e79-7d64-4a15-b617-e37cc2c44098@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:23,542 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n______________________________ test_token_refresh ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:124: in test_token_refresh\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('refresh_test_f7c28021-8c2b-4a0a-88e1-6dec8cda0423@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:24,675 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_________________________ test_protected_route_access __________________________\ntests/test_auth.py:142: in test_protected_route_access\n    assert response.status_code == 401\nE   assert 403 == 401\nE    +  where 403 = <Response [403 Forbidden]>.status_code\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:25,649 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:13:25,653 - httpx - INFO - HTTP Request: GET http://testserver/user/profile \"HTTP/1.1 403 Forbidden\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/user/profile \"HTTP/1.1 403 Forbidden\"\n______________________________ test_rate_limiting ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:165: in test_rate_limiting\n    response = client.post(\"/auth/login\", json={\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:117: in login\n    user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('test@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:25,662 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_password_reset_flow ___________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:183: in test_password_reset_flow\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('reset_test_3748f53c-58f5-41de-9013-257b2f98cecc@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:26,650 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_input_sanitization ____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:201: in test_input_sanitization\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('sanitization_test_173c35cf-f86b-46d0-b9d4-c9173ebd367f@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:27,655 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_________________________________ test_logout __________________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:214: in test_logout\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('logout_test_eb13fbd5-fe9d-4459-8973-f31583799968@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:13:28,639 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n____________________________ test_security_headers _____________________________\ntests/test_security.py:13: in test_security_headers\n    assert \"X-XSS-Protection\" in response.headers\nE   AssertionError: assert 'X-XSS-Protection' in Headers({'content-length': '380', 'content-type': 'application/json'})\nE    +  where Headers({'content-length': '380', 'content-type': 'application/json'}) = <Response [200 OK]>.headers\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:04,468 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:15:04,472 - httpx - INFO - HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n______________________________ test_cors_headers _______________________________\ntests/test_security.py:26: in test_cors_headers\n    assert \"access-control-allow-origin\" in response.headers\nE   AssertionError: assert 'access-control-allow-origin' in Headers({'vary': 'Origin', 'access-control-allow-methods': 'DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT', 'access-con...ith', 'access-control-allow-credentials': 'true', 'content-length': '22', 'content-type': 'text/plain; charset=utf-8'})\nE    +  where Headers({'vary': 'Origin', 'access-control-allow-methods': 'DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT', 'access-con...ith', 'access-control-allow-credentials': 'true', 'content-length': '22', 'content-type': 'text/plain; charset=utf-8'}) = <Response [400 Bad Request]>.headers\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:04,481 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:15:04,485 - httpx - INFO - HTTP Request: OPTIONS http://testserver/health \"HTTP/1.1 400 Bad Request\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: OPTIONS http://testserver/health \"HTTP/1.1 400 Bad Request\"\n_____________________________ test_xss_protection ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:42: in test_xss_protection\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('xss_test_7f4a9c02-caf4-4174-9810-52f98789dacc@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:04,493 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_____________________________ test_csrf_protection _____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:82: in test_csrf_protection\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('csrf_test_dd529ca8-03d7-413a-bedb-d3a731b1f0ca@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:05,411 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n__________________________ test_rate_limit_protection __________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:91: in test_rate_limit_protection\n    response = client.post(\"/auth/login\", json={\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:117: in login\n    user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('test@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:06,881 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_password_complexity ___________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:138: in test_password_complexity\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('weak_4065c444-d952-42e1-9bc0-7844c5179f74@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:08,374 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_jwt_token_security ____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:151: in test_jwt_token_security\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('jwt_test_18608904-054c-43f3-9839-0eefac19ee87@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:10,989 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n____________________________ test_session_security _____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:192: in test_session_security\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('session_test_70b2d760-c520-488d-a6f9-7d07ae5185aa@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:30,240 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_________________________ test_content_security_policy _________________________\ntests/test_security.py:219: in test_content_security_policy\n    assert csp_header is not None\nE   assert None is not None\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:31,491 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:15:31,497 - httpx - INFO - HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n=============================== warnings summary ===============================\nvenv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nvenv/lib/python3.12/site-packages/passlib/utils/__init__.py:854\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13\n    from crypt import crypt as _crypt\n\napp/models/user.py:8\n  /home/husni/project-permit-api/app/models/user.py:8: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)\n    Base = declarative_base()\n\napp/api_server.py:231\n  /home/husni/project-permit-api/app/api_server.py:231: DeprecationWarning: \n          on_event is deprecated, use lifespan event handlers instead.\n  \n          Read more about it in the\n          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).\n          \n    @app.on_event(\"startup\")\n\nvenv/lib/python3.12/site-packages/fastapi/applications.py:4495\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/fastapi/applications.py:4495: DeprecationWarning: \n          on_event is deprecated, use lifespan event handlers instead.\n  \n          Read more about it in the\n          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).\n          \n    return self.router.on_event(event_type)\n\ntests/test_cevs.py: 20 warnings\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/openpyxl/packaging/core.py:99: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    now = datetime.datetime.utcnow()\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/test_auth.py::test_user_registration - sqlalchemy.exc.Operationa...\nFAILED tests/test_auth.py::test_user_login - sqlalchemy.exc.OperationalError:...\nFAILED tests/test_auth.py::test_invalid_login - sqlalchemy.exc.OperationalErr...\nFAILED tests/test_auth.py::test_password_validation - sqlalchemy.exc.Operatio...\nFAILED tests/test_auth.py::test_duplicate_email_registration - sqlalchemy.exc...\nFAILED tests/test_auth.py::test_token_refresh - sqlalchemy.exc.OperationalErr...\nFAILED tests/test_auth.py::test_protected_route_access - assert 403 == 401\nFAILED tests/test_auth.py::test_rate_limiting - sqlalchemy.exc.OperationalErr...\nFAILED tests/test_auth.py::test_password_reset_flow - sqlalchemy.exc.Operatio...\nFAILED tests/test_auth.py::test_input_sanitization - sqlalchemy.exc.Operation...\nFAILED tests/test_auth.py::test_logout - sqlalchemy.exc.OperationalError: (sq...\nFAILED tests/test_security.py::test_security_headers - AssertionError: assert...\nFAILED tests/test_security.py::test_cors_headers - AssertionError: assert 'ac...\nFAILED tests/test_security.py::test_xss_protection - sqlalchemy.exc.Operation...\nFAILED tests/test_security.py::test_csrf_protection - sqlalchemy.exc.Operatio...\nFAILED tests/test_security.py::test_rate_limit_protection - sqlalchemy.exc.Op...\nFAILED tests/test_security.py::test_password_complexity - sqlalchemy.exc.Oper...\nFAILED tests/test_security.py::test_jwt_token_security - sqlalchemy.exc.Opera...\nFAILED tests/test_security.py::test_session_security - sqlalchemy.exc.Operati...\nFAILED tests/test_security.py::test_content_security_policy - assert None is ...\n====== 20 failed, 40 passed, 16 skipped, 25 warnings in 136.95s (0:02:16) ======\n\n[2025-09-06 00:15:32] INFO: \n\ud83d\udccb Running Auth Tests...\n[2025-09-06 00:15:32] INFO: Running authentication tests...\n[2025-09-06 00:15:32] INFO: Running: Authentication tests\n[2025-09-06 00:15:47] INFO: \u274c Authentication tests failed\n[2025-09-06 00:15:47] INFO: ============================= test session starts ==============================\nplatform linux -- Python 3.12.3, pytest-7.4.0, pluggy-1.6.0\nrootdir: /home/husni/project-permit-api\nconfigfile: pytest.ini\nplugins: anyio-4.10.0\ncollected 12 items\n\ntests/test_auth.py FFFF.FFFFFFF                                          [100%]\n\n=================================== FAILURES ===================================\n____________________________ test_user_registration ____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:22: in test_user_registration\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('test_7a6fcd3a-77bc-443c-9c6b-47477f5ada21@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:36,603 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_______________________________ test_user_login ________________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:40: in test_user_login\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('login_test_b50e4c0d-65e9-4a53-bfe6-bfbdf6a4d251@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:38,195 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n______________________________ test_invalid_login ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:64: in test_invalid_login\n    response = client.post(\"/auth/login\", json=login_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:117: in login\n    user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('nonexistent@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:39,031 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_password_validation ___________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:76: in test_password_validation\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('weak_pass_c050dae3-398d-4944-a9bd-97168edd244c@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:39,875 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n______________________ test_duplicate_email_registration _______________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:102: in test_duplicate_email_registration\n    response1 = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('duplicate_7bca3eca-2f66-436d-ba7f-1f4d3452b990@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:40,723 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n______________________________ test_token_refresh ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:124: in test_token_refresh\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('refresh_test_3ef80c9e-edc9-46b4-926c-fc734ef9bcd6@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:41,784 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_________________________ test_protected_route_access __________________________\ntests/test_auth.py:142: in test_protected_route_access\n    assert response.status_code == 401\nE   assert 403 == 401\nE    +  where 403 = <Response [403 Forbidden]>.status_code\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:42,884 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:15:42,909 - httpx - INFO - HTTP Request: GET http://testserver/user/profile \"HTTP/1.1 403 Forbidden\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/user/profile \"HTTP/1.1 403 Forbidden\"\n______________________________ test_rate_limiting ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:165: in test_rate_limiting\n    response = client.post(\"/auth/login\", json={\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:117: in login\n    user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('test@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:42,947 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_password_reset_flow ___________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:183: in test_password_reset_flow\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('reset_test_d20343e7-89b3-4203-8c25-6d20b392199c@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:44,272 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_input_sanitization ____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:201: in test_input_sanitization\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('sanitization_test_02f11c64-03ce-4ae8-873e-1e777eedc01f@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:45,096 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_________________________________ test_logout __________________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_auth.py:214: in test_logout\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('logout_test_b8904710-6ef9-494d-a439-e4c8a99f7e41@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:45,914 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n=============================== warnings summary ===============================\nvenv/lib/python3.12/site-packages/passlib/utils/__init__.py:854\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13\n    from crypt import crypt as _crypt\n\napp/models/user.py:8\n  /home/husni/project-permit-api/app/models/user.py:8: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)\n    Base = declarative_base()\n\napp/api_server.py:231\n  /home/husni/project-permit-api/app/api_server.py:231: DeprecationWarning: \n          on_event is deprecated, use lifespan event handlers instead.\n  \n          Read more about it in the\n          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).\n          \n    @app.on_event(\"startup\")\n\nvenv/lib/python3.12/site-packages/fastapi/applications.py:4495\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/fastapi/applications.py:4495: DeprecationWarning: \n          on_event is deprecated, use lifespan event handlers instead.\n  \n          Read more about it in the\n          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).\n          \n    return self.router.on_event(event_type)\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/test_auth.py::test_user_registration - sqlalchemy.exc.Operationa...\nFAILED tests/test_auth.py::test_user_login - sqlalchemy.exc.OperationalError:...\nFAILED tests/test_auth.py::test_invalid_login - sqlalchemy.exc.OperationalErr...\nFAILED tests/test_auth.py::test_password_validation - sqlalchemy.exc.Operatio...\nFAILED tests/test_auth.py::test_duplicate_email_registration - sqlalchemy.exc...\nFAILED tests/test_auth.py::test_token_refresh - sqlalchemy.exc.OperationalErr...\nFAILED tests/test_auth.py::test_protected_route_access - assert 403 == 401\nFAILED tests/test_auth.py::test_rate_limiting - sqlalchemy.exc.OperationalErr...\nFAILED tests/test_auth.py::test_password_reset_flow - sqlalchemy.exc.Operatio...\nFAILED tests/test_auth.py::test_input_sanitization - sqlalchemy.exc.Operation...\nFAILED tests/test_auth.py::test_logout - sqlalchemy.exc.OperationalError: (sq...\n================== 11 failed, 1 passed, 4 warnings in 14.00s ===================\n\n[2025-09-06 00:15:47] INFO: \n\ud83d\udccb Running Security Tests...\n[2025-09-06 00:15:47] INFO: Running security tests...\n[2025-09-06 00:15:47] INFO: Running: Security tests\n[2025-09-06 00:16:19] INFO: \u274c Security tests failed\n[2025-09-06 00:16:19] INFO: ============================= test session starts ==============================\nplatform linux -- Python 3.12.3, pytest-7.4.0, pluggy-1.6.0\nrootdir: /home/husni/project-permit-api\nconfigfile: pytest.ini\nplugins: anyio-4.10.0\ncollected 13 items\n\ntests/test_security.py FFF.FF.FF.F.F                                     [100%]\n\n=================================== FAILURES ===================================\n____________________________ test_security_headers _____________________________\ntests/test_security.py:13: in test_security_headers\n    assert \"X-XSS-Protection\" in response.headers\nE   AssertionError: assert 'X-XSS-Protection' in Headers({'content-length': '380', 'content-type': 'application/json'})\nE    +  where Headers({'content-length': '380', 'content-type': 'application/json'}) = <Response [200 OK]>.headers\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:50,598 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:15:50,603 - httpx - INFO - HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n______________________________ test_cors_headers _______________________________\ntests/test_security.py:26: in test_cors_headers\n    assert \"access-control-allow-origin\" in response.headers\nE   AssertionError: assert 'access-control-allow-origin' in Headers({'vary': 'Origin', 'access-control-allow-methods': 'DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT', 'access-con...ith', 'access-control-allow-credentials': 'true', 'content-length': '22', 'content-type': 'text/plain; charset=utf-8'})\nE    +  where Headers({'vary': 'Origin', 'access-control-allow-methods': 'DELETE, GET, HEAD, OPTIONS, PATCH, POST, PUT', 'access-con...ith', 'access-control-allow-credentials': 'true', 'content-length': '22', 'content-type': 'text/plain; charset=utf-8'}) = <Response [400 Bad Request]>.headers\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:50,784 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:15:50,787 - httpx - INFO - HTTP Request: OPTIONS http://testserver/health \"HTTP/1.1 400 Bad Request\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: OPTIONS http://testserver/health \"HTTP/1.1 400 Bad Request\"\n_____________________________ test_xss_protection ______________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:42: in test_xss_protection\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('xss_test_9446e9a3-58a7-44a3-a827-9d7412941eca@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:50,883 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_____________________________ test_csrf_protection _____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:82: in test_csrf_protection\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('csrf_test_b7f97d45-edf8-4c40-8b45-6b8412cd574f@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:51,919 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n__________________________ test_rate_limit_protection __________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:91: in test_rate_limit_protection\n    response = client.post(\"/auth/login\", json={\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:117: in login\n    user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('test@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:52,915 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_password_complexity ___________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:138: in test_password_complexity\n    response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('weak_f4edeceb-729e-4d55-8279-253b8e77352d@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:53,786 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n___________________________ test_jwt_token_security ____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:151: in test_jwt_token_security\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('jwt_test_42114c57-e10c-4743-a90b-f1198778293b@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:15:54,692 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n____________________________ test_session_security _____________________________\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlite3.OperationalError: no such column: users.avatar_url\n\nThe above exception was the direct cause of the following exception:\ntests/test_security.py:192: in test_session_security\n    register_response = client.post(\"/auth/register\", json=user_data)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:552: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1145: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:451: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:827: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:914: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1015: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:291: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/usr/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/usr/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:222: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:113: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:182: in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n/usr/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:85: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:184: in __call__\n    response = await self.dispatch_func(request, call_next)\napp/utils/security_middleware.py:40: in dispatch\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:159: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:144: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:29: in __call__\n    await responder(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:130: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/gzip.py:46: in __call__\n    await self.app(scope, receive, self.send_with_compression)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:85: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:716: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:736: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:290: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:78: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:75: in app\n    response = await f(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:302: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:213: in run_endpoint_function\n    return await dependant.call(**values)\napp/routes/auth.py:66: in register\n    existing_user = db.query(User).filter(User.email == user_data.email).first()\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2759: in first\n    return self.limit(1)._iter().first()  # type: ignore\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/query.py:2857: in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2365: in execute\n    return self._execute_internal(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\nvenv/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement\n    result = conn.execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute\n    return meth(\nvenv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection\n    return connection._execute_clauseelement(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement\n    ret = self._execute_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context\n    return self._exec_single_context(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context\n    self._handle_dbapi_exception(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context\n    self.dialect.do_execute(\nvenv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: in do_execute\n    cursor.execute(statement, parameters)\nE   sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.avatar_url\nE   [SQL: SELECT users.id AS users_id, users.email AS users_email, users.password_hash AS users_password_hash, users.name AS users_name, users.company AS users_company, users.job_title AS users_job_title, users.avatar_url AS users_avatar_url, users.timezone AS users_timezone, users.email_verified AS users_email_verified, users.email_verification_token AS users_email_verification_token, users.email_verification_expires AS users_email_verification_expires, users.password_reset_token AS users_password_reset_token, users.password_reset_expires AS users_password_reset_expires, users.last_login AS users_last_login, users.two_factor_secret AS users_two_factor_secret, users.two_factor_enabled AS users_two_factor_enabled, users.created_at AS users_created_at, users.updated_at AS users_updated_at \nE   FROM users \nE   WHERE users.email = ?\nE    LIMIT ? OFFSET ?]\nE   [parameters: ('session_test_e1e38adc-4c1c-40e6-8b68-5deb362c8e3d@example.com', 1, 0)]\nE   (Background on this error at: https://sqlalche.me/e/20/e3q8)\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:16:18,086 - asyncio - DEBUG - Using selector: EpollSelector\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\n_________________________ test_content_security_policy _________________________\ntests/test_security.py:219: in test_content_security_policy\n    assert csp_header is not None\nE   assert None is not None\n----------------------------- Captured stderr call -----------------------------\n2025-09-06 00:16:19,082 - asyncio - DEBUG - Using selector: EpollSelector\n2025-09-06 00:16:19,086 - httpx - INFO - HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n------------------------------ Captured log call -------------------------------\nDEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector\nINFO     httpx:_client.py:1026 HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"\n=============================== warnings summary ===============================\nvenv/lib/python3.12/site-packages/passlib/utils/__init__.py:854\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13\n    from crypt import crypt as _crypt\n\napp/models/user.py:8\n  /home/husni/project-permit-api/app/models/user.py:8: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)\n    Base = declarative_base()\n\napp/api_server.py:231\n  /home/husni/project-permit-api/app/api_server.py:231: DeprecationWarning: \n          on_event is deprecated, use lifespan event handlers instead.\n  \n          Read more about it in the\n          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).\n          \n    @app.on_event(\"startup\")\n\nvenv/lib/python3.12/site-packages/fastapi/applications.py:4495\n  /home/husni/project-permit-api/venv/lib/python3.12/site-packages/fastapi/applications.py:4495: DeprecationWarning: \n          on_event is deprecated, use lifespan event handlers instead.\n  \n          Read more about it in the\n          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).\n          \n    return self.router.on_event(event_type)\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/test_security.py::test_security_headers - AssertionError: assert...\nFAILED tests/test_security.py::test_cors_headers - AssertionError: assert 'ac...\nFAILED tests/test_security.py::test_xss_protection - sqlalchemy.exc.Operation...\nFAILED tests/test_security.py::test_csrf_protection - sqlalchemy.exc.Operatio...\nFAILED tests/test_security.py::test_rate_limit_protection - sqlalchemy.exc.Op...\nFAILED tests/test_security.py::test_password_complexity - sqlalchemy.exc.Oper...\nFAILED tests/test_security.py::test_jwt_token_security - sqlalchemy.exc.Opera...\nFAILED tests/test_security.py::test_session_security - sqlalchemy.exc.Operati...\nFAILED tests/test_security.py::test_content_security_policy - assert None is ...\n=================== 9 failed, 4 passed, 4 warnings in 31.12s ===================\n\n[2025-09-06 00:16:19] INFO: \n\ud83d\udccb Running API Integration...\n[2025-09-06 00:16:19] INFO: Testing API integration...\n[2025-09-06 00:16:19] INFO: \u274c API integration test failed: HTTPConnectionPool(host='localhost', port=8000): Max retries exceeded with url: /health (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7ce4162d4d40>: Failed to establish a new connection: [Errno 111] Connection refused'))\n[2025-09-06 00:16:19] INFO: \n\ud83d\udccb Running Load Performance...\n[2025-09-06 00:16:19] INFO: Running basic load performance test...\n[2025-09-06 00:16:19] INFO: Running: Load performance test\n[2025-09-06 00:16:19] INFO: \u274c Load performance test failed\n[2025-09-06 00:16:19] INFO:   File \"/home/husni/project-permit-api/scripts/load_test_auth.py\", line 79\n    print(\"\ud83d\udcca Registration Load Test Results:\"        print(f\"   Total Requests: {len(results)}\")\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nSyntaxError: invalid syntax. Perhaps you forgot a comma?\n\n[2025-09-06 00:16:19] INFO: \n\ud83d\udccb Running Security Scan...\n[2025-09-06 00:16:19] INFO: Running basic security scan...\n[2025-09-06 00:16:19] INFO: \u274c Security scan found issues\n[2025-09-06 00:16:19] INFO:    - Potential sensitive data in .env\n[2025-09-06 00:16:19] INFO: Test report saved to: /home/husni/project-permit-api/test_report_20250906_001619.json\n[2025-09-06 00:16:19] INFO: \n==================================================\n[2025-09-06 00:16:19] INFO: \ud83d\udcca CI/CD Test Summary:\n[2025-09-06 00:16:19] INFO:    Total Tests: 8\n[2025-09-06 00:16:19] INFO:    Passed: 1\n[2025-09-06 00:16:19] INFO:    Failed: 7\n[2025-09-06 00:16:19] INFO:    Success Rate: 12.5%\n[2025-09-06 00:16:19] INFO:    Duration: 187.44s\n[2025-09-06 00:16:19] INFO: \u274c Some CI/CD tests failed!\n[2025-09-06 00:16:19] INFO:    \ud83d\udca1 Review failed tests and fix issues before deployment\n[2025-09-06 00:16:19] INFO:    \ud83d\udca1 Address security scan findings\n[2025-09-06 00:16:19] INFO:    \ud83d\udca1 Investigate performance issues\n",
      "stderr": "",
      "duration": 187.7713086605072
    },
    {
      "script": "scripts/load_test_auth.py",
      "description": "Load Tests",
      "success": false,
      "return_code": 1,
      "stdout": "",
      "stderr": "  File \"/home/husni/project-permit-api/scripts/load_test_auth.py\", line 79\n    print(\"\ud83d\udcca Registration Load Test Results:\"        print(f\"   Total Requests: {len(results)}\")\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nSyntaxError: invalid syntax. Perhaps you forgot a comma?\n",
      "duration": 0.09821891784667969
    },
    {
      "script": "scripts/stress_test_db.py",
      "description": "Stress Tests",
      "success": false,
      "return_code": 1,
      "stdout": "",
      "stderr": "  File \"/home/husni/project-permit-api/scripts/stress_test_db.py\", line 142\n    print(\"\ud83d\udcca Concurrent API Calls Test Results:\"        print(f\"   Total Requests: {len(results)}\")\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nSyntaxError: invalid syntax. Perhaps you forgot a comma?\n",
      "duration": 0.051055908203125
    }
  ],
  "critical_failures": [
    "Deployment Validation",
    "CI/CD Tests"
  ],
  "non_critical_failures": [
    "Unit Tests",
    "Load Tests",
    "Stress Tests"
  ],
  "recommendations": [
    "Fix all critical failures before deployment",
    "Run deployment validation and fix configuration issues",
    "Fix CI/CD test failures and security issues",
    "Address non-critical failures for optimal performance",
    "Optimize performance for production load",
    "Improve system resilience under stress"
  ]
}